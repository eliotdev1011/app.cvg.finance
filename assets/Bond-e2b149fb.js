import{r as a,$ as U,e as R,G as Fe,az as B,a0 as he,a4 as De,j as e,h as ke,aa as Ve,d as D,ab as q,n as k,a1 as Xe,a7 as O,a6 as es,Y as we,Q as Me,ai as Oe,ak as be,p as qe,aA as Re,aB as ss,ao as Ge,k as $e,ae as Ce,at as ns,ad as ts,a2 as as,af as We,ap as Se,_ as ls}from"./index-614b6d1c.js";import{K as le}from"./KeyValueDisplay-ec59a4c2.js";import{P as os,a as Pe}from"./PageHelp-3dfbb5e1.js";import{H as fe}from"./HeaderInfoPanelContainer-15db6aee.js";import{S as ye,M as He}from"./MaxButton-198646ac.js";import{a as is,I as Ne}from"./inputnumber.esm-7912d73a.js";import{B as cs}from"./BlockCvgPrice-a35422e8.js";import{E as rs}from"./ErrorDisplay-8be22464.js";import{C as ve,A as ds,a as ms}from"./AllocationSlider-b467ce73.js";import{P as Ue}from"./ProgressMarker-94cd9f18.js";import{P as _e}from"./ProcessActionButton-77d53bd6.js";import{D as Ye}from"./dropdown.esm-4d742924.js";import{T as xs,C as re}from"./ContractDisplay-4267b497.js";import{S as Ke}from"./Slippage-d86a5baa.js";import{I as ze}from"./InfoCircle-1ebdcaad.js";import{d as Te}from"./utils-03ca5988.js";import{T as Le,S as de}from"./SortHeader-c05039fc.js";import"./lock.service-f4c84d65.js";import"./rewards.service-40a9454a.js";import"./ysCvgClaim.service-bbde5ab6.js";import"./ValueConnectedButton-ea3b8760.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="1e8575fc-06e9-434f-94fe-64208af6c0f0",s._sentryDebugIdIdentifier="sentry-dbid-1e8575fc-06e9-434f-94fe-64208af6c0f0")}catch{}})();const Ie={name:"new",code:0},T=a.createContext(null),us={category:"All",keyword:void 0,sort:void 0,sortDirection:1},ps=({children:s})=>{const{address:t,isWellConnected:n,getSigner:c,getEthBalance:r}=U(),[i,d]=a.useState(us),[o,h]=a.useState(void 0),[f,p]=a.useState(void 0),[b,N]=a.useState(void 0),[w,C]=a.useState(!1),[J,L]=a.useState(void 0),[Y,G]=a.useState(void 0),{ecosystemInfo:K,currentBlock:V}=a.useContext(R),{handleTransaction:X,notifyError:ee}=a.useContext(Fe);a.useEffect(()=>{se()},[t]);const se=()=>{r().then(l=>G(l))};a.useEffect(()=>{const l=setInterval(()=>{S().then()},3e4);return()=>clearInterval(l)},[]);const $=a.useMemo(()=>!o||o.loading||o.error?o:[...o.filter(l=>l.isOver)],[o]),ne=a.useMemo(()=>{if(!i||!o||o.loading||o.error)return o;let l=[...o.filter(m=>!m.isOver)];return l=B.filterList(l,i),l.sort(B.sortList(i)),l},[i,o]);a.useEffect(()=>{o===void 0&&V&&!V?.loading&&P().then(),J===void 0&&F().then()},[o,V]),a.useEffect(()=>{f===void 0&&n&&H().then()},[f,n,t]),a.useEffect(()=>{b===void 0&&n&&ce().then()},[o,n,t]);const P=async()=>{await he(async()=>await B.getBondList(),x=>{I(x),h(x)})},I=l=>{Array.isArray(l)&&l?.forEach(m=>{const x=m.token.token.toUpperCase();m.url=x==="CRV"?ke:`/images/token/${m.token.token}.webp`,m.available=m?.bondParameters?.cvgToSell-m.cvgAlreadySold,m.fillingPercentage=Math.trunc(Number(Ve(m.available)/Number(Ve(m?.bondParameters?.cvgToSell)))*100),m.isFuture=V?m.startBondTimestamp>V.timestamp:!1,m.maxToMint=D(m.bondParameters.cvgToSell,18),m.maxBondAtOneTime=Number(m.bondParameters.percentageOneTx)*m.maxToMint/1e3*.99})},F=async()=>{L({loading:!0}),B.getBondHeader(t).then(l=>{L(l)}).catch(l=>{ee(l),L({error:!0,message:l.message})})},M=async l=>{const m=(await B.getTokenIds(t))?.map(j=>Number(j)),x=f.map(j=>j.tokenId);let u=new Set;m.filter(j=>!x.includes(j)).forEach(j=>u+j),f.filter(j=>j.bondId===l).forEach(j=>u+j.tokenId),u=Array.from(u).sort(),await he(async()=>await B.getNftData(t),j=>{!j||j?.loading||j?.error||(ae(j),p(j))})},S=async()=>{const l=await B.getBondList();I(l),h(l)},te=async l=>{await he(async()=>await B.getBondData(l),u=>{if(!u||u?.loading||u?.error)return;const v=[...o],A=v.findIndex(j=>j.bondId===l);v.splice(A,1,u),I(v),h(v)}),se()},W=async l=>{await te(l)},oe=async l=>{const m=o.find(x=>x.bondId===l)?.token?.tokenAddress;z(m).then(),te(l).then(()=>M(l))},H=async()=>{await he(async()=>await B.getNftData(t),x=>{ae(x),p(x)})},ae=l=>{!l.loading&&!l.error&&l.forEach(m=>{m.isClaimable=m.claimableCvg>0n})},ie=a.useMemo(()=>!f?.length||f?.loading||f?.error?0:f.filter(l=>l.isClaimable)?.length,[f]);async function ce(){if(o===void 0||o?.loading||o.error)return;const l=[];o.forEach(x=>{l.push({token:x?.token?.tokenAddress,contract:K.bondDepository,asset:x?.token})});const m=await De.getTokenInfos(t,l);N(m)}const z=async l=>{if(l)return await De.refreshTokenInfos(t,{token:l,contract:K.bondDepository})},E={bondList:ne,initialBondList:o,concludedBondList:$,bondUserData:f,walletInfo:b,refreshWallet:async l=>{const m=await z(l),x={...b,[l]:m};N(x)},filter:i,updateFilter:(l,m)=>{if(!["keyword","category","sort"].includes(l))return;const x={...i||{},[l]:m};l==="sort"&&(i.sort===x.sort?x.sortDirection*=-1:x.sortDirection=1),d(x)},resetBondData:W,getBuyData:(l,m)=>{if(!l||l?.loading||l?.error||!b||b?.loading||b?.error)return;const x=b[l.token.tokenAddress],u=x?.allowance[K.bondDepository],v=D(x?.balanceOf,l.token.decimals),A=D(Y,18),j=l.isWethBond&&m?A:v,Q=D(l.bondParameters.cvgToSell-l.cvgAlreadySold,18),ge=j/D(l.assetBondPrice,18),Ae=Math.min(Q,ge,l.maxBondAtOneTime),Je=Ae*D(l.assetBondPrice,l?.token?.decimals);return{balanceOf:D(x?.balanceOf,l?.token?.decimals),allowance:D(u,l?.token?.decimals),allowanceRaw:u,maxValue:Ae,remainingValue:Q,availableValue:ge,availableAmount:j,maxAssetValue:Je,tokenBalance:v,ethBalance:Y}},newToken:Ie,getNftOptions:l=>{const m=[Ie];return!f||f?.loading||f?.error||f?.filter(x=>x.bondId===l.bondId).forEach(x=>{const u=D(x?.claimableCvg,18);m.push({code:x.tokenId,claimable:`${q(x?.claimableCvg,18)}`,amount:k(x.claimable+x.leftClaimable),claimableRaw:u})}),m},claimAllVisible:w,setClaimAllVisible:C,doClaimAll:async l=>{await Xe(async()=>{const u=await c();return await B.doRedeem(l,t,u)},()=>{C(!1),p(void 0)},X,ee)},resetBondUserData:M,resetBondAllData:oe,refreshBonds:S,claimablePositionLength:ie,bondHeader:J,ethBalance:Y};return e.jsx(T.Provider,{value:E,children:s})};function gs(){const{bondHeader:s}=a.useContext(T),{isWellConnected:t}=U(),n=()=>!s||s?.loading?e.jsxs(fe,{children:[e.jsxs(Pe,{title:"Bond info",children:["Deposit one of the underlying assets listed below and receive vested ",e.jsx("span",{className:"color-tonic",children:"CVG"})," tokens at a discounted price. Bond positions are represented by NFTs."]}),e.jsx(O,{className:"w-full  p-1 m-1"}),e.jsx(O,{className:"w-full  p-1 m-1"})]}):e.jsxs(fe,{children:[e.jsxs(Pe,{title:"Bond info",children:["Deposit one of the underlying assets listed below and receive vested ",e.jsx("span",{className:"color-tonic",children:"CVG"})," tokens at a discounted price. Bond positions are represented by NFTs."]}),e.jsx(le,{label:"Total Bonded",value:s?.totalCvgBondedString,className:"is-highlight"}),e.jsx(le,{label:"Total Redeemed",value:s?.totalCvgRedeemedString,className:"is-highlight"})]}),c=()=>t?!s||s?.loading?e.jsxs(fe,{children:[e.jsx(O,{className:"w-full  p-1 m-1"}),e.jsx(O,{className:"w-full  p-1 m-1"}),e.jsx(O,{className:"w-full  p-1 m-1"}),e.jsx(O,{className:"w-full  p-1 m-1"})]}):e.jsxs(fe,{children:[e.jsx(le,{label:"CVG redeemed",value:s?.userCvgRedeem,className:"is-highlight"}),e.jsx(le,{label:"Deposited (Stablecoin)",value:"$"+s?.userStablecoinDeposited,className:"is-highlight"}),e.jsx(le,{label:"Deposited (Asset)",value:"$"+s?.userAssetDeposited,className:"is-highlight"}),e.jsx(le,{label:"Total Deposited",value:"$"+s?.userTotalDeposited,className:"is-highlight"})]}):e.jsx(es,{});return e.jsxs(os,{children:[e.jsx(e.Fragment,{children:e.jsx(n,{})}),e.jsx(e.Fragment,{children:e.jsx(c,{})})]})}function hs({options:s,children:t,callBacks:n}){const[c,r]=a.useState(s?.at(0)),i=a.useMemo(()=>s.findIndex(o=>c?.code===o.code)||0,[c]);n[i]&&n[i]();const d=o=>{o.value&&o.value!==c&&r(o.value)};return e.jsxs(we,{className:"mb-4 mt-4 md:mt-8",children:[e.jsx("div",{className:"mb-4 Tab",children:e.jsx(ye,{className:" m-0 inline-flex white-space-nowrap gap-3 w-auto",optionLabel:"name",value:c,options:s,onChange:d})}),e.jsx("div",{className:" md:relative -top-2rem",children:t.at(i)})]})}function fs(){const{filter:s,updateFilter:t,setClaimAllVisible:n,claimablePositionLength:c}=a.useContext(T),{isWellConnected:r}=U();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-content-between  flex-wrap align-items-center  relative -top-2rem",children:[e.jsx("div",{children:e.jsx(cs,{})}),e.jsx("div",{className:"text-right ",children:e.jsx(Me,{className:"Btn",type:"button",disabled:!r||!c,onClick:()=>n(!0),children:e.jsxs("div",{className:"flex flex-wrap gap-1 align-items-center text-left ",children:[e.jsx("div",{children:"Redeem bonds"}),e.jsxs("div",{className:"text-xs",children:["(",c||"0"," positions)"]})]})})})]}),e.jsx("div",{className:"grid mb-5 ",children:e.jsx("div",{className:" col-12",children:e.jsxs("div",{className:"flex flex-wrap gap-2 align-items-center",children:[e.jsxs("span",{className:"p-input-icon-left lg:mr-5 ",children:[e.jsx("i",{className:"pi pi-search  color-white"}),e.jsx(is,{type:"search",className:"quiet-input xl:min-w-20rem w-full",value:s?.keyword,onChange:i=>{t("keyword",i.target.value)},placeholder:"Search by name ..."})]}),["All","Stable","Asset"].map(i=>e.jsx("button",{className:`Btn Btn-quiet lg:my-0 ${s?.category===i?"is-active":""}`,type:"button",onClick:()=>t("category",i),children:e.jsxs("span",{className:"capitalize",children:[" ",i]})},i))]})})})]})}const Z=a.createContext(null),je={name:"new",code:0},js=({children:s})=>{const{getSigner:t}=U(),[n,c]=a.useState(),[r,i]=a.useState(!1),[d,o]=a.useState(je),[h,f]=a.useState(je),[p,b]=a.useState(0),[N,w]=a.useState(!1),[C,J]=a.useState(!1),[L,Y]=a.useState(.1),[G,K]=a.useState(!1),{ecosystemInfo:V}=a.useContext(R),{lockParams:X,lockInfo:ee,loadLockParamsForTokenId:se}=a.useContext(ve),{doApprove:$}=a.useContext(Oe),{getBuyData:ne,refreshWallet:P,walletInfo:I}=a.useContext(T),F=a.useMemo(()=>ne(n,G),[n,G]),M=()=>{const g=n?.assetBondPrice;return p/D(g,18)},S=g=>{f(g)},te=()=>{const g=[...n.dropdownConfig];return g.splice(0,1,je),g},W=g=>{se(g?.code),o(g)},oe=()=>{const g=[je];return ee?.positions?.forEach(y=>{g.push({name:y?.tokenId.toString(),code:Number(y?.tokenId),token:"CVG",amount:q(y?.cvgLocked)})}),g},H=async g=>{b(g)},ae=(g,y,E)=>{c(g),i(!0),b(y),K(E)};function ie(){const g=()=>P(n.token.tokenAddress);$(n.token.tokenAddress,V.bondDepository,g).then()}const ce=a.useMemo(()=>B.getCvgAmountOutMin(M(),L),[p,L]),z=()=>{const g=[];let y=!0;p===0&&(g.push("No bond amount"),y=!1);const l=F?.allowanceRaw||0n;return y&&l<be(p?.toString()||"0",n?.token?.decimals)&&(y=!1,l===0n?g.push(`You must approve ${n?.token?.token} on Bond`):g.push(`You must increase allowance for ${n?.token?.token} on Bond / current allowance : ${q(l,n?.token?.decimals)}`)),[y,g]},xe=async()=>{const g=qe(B.getCvgAmountOutMin(M(),L).toString()),y=be(p?.toString()||"0",n?.token?.decimals),E=await t();return await(async()=>B.doBondAndLock(n?.bondId,d?.code,y,X?.timeOption?.code,X?.repartition,g,E,G))()},ue=a.useMemo(()=>{const g=[];if(p||g.push("No amount."),I&&!n?.isWethBond){const y=I[n?.token?.tokenAddress],E=D(y?.balanceOf,n?.token?.decimals);p>E&&g.push("Not enough balance.")}return M()>F?.maxValue&&g.push(`You cannot buy as many CVGs in a single transaction, max:${k(F?.maxValue)}`),{active:g.length===0,errors:g}},[p,F?.maxValue,I]),pe={buyData:F,openSwapAndBond:ae,bondInfo:n,swapAndBondVisible:r,setSwapAndBondVisible:i,bondInValue:p,updateBondInAmount:H,doApproveBond:ie,doBondAndLock:xe,canPerformDoSwapBondLock:z,getCvgAmount:M,selectedLockPosition:d,updateSelectLockPosition:W,getLockPositionsOptions:oe,selectedBondPosition:h,updateSelectBondPosition:S,getLockBondOptions:te,processing:N,setProcessing:w,resetList:C,setResetList:J,slippage:L,setSlippage:Y,isDepositActive:ue,cvgReceivedMin:ce,isEth:G};return e.jsx(Z.Provider,{value:pe,children:s})},_=a.createContext(null),vs=({children:s,bondInfo:t})=>{const{address:n,getSigner:c,isWellConnected:r}=U(),{handleTransaction:i,notifyError:d}=a.useContext(Fe),{doApprove:o}=a.useContext(Oe),{resetList:h,setResetList:f}=a.useContext(Z),{ecosystemInfo:p,currentBlock:b}=a.useContext(R),{walletInfo:N,refreshWallet:w,bondUserData:C,resetBondAllData:J,getBuyData:L,newToken:Y,getNftOptions:G,ethBalance:K}=a.useContext(T),[V,X]=a.useState(!1),[ee,se]=a.useState(!1),[$,ne]=a.useState(void 0),[P,I]=a.useState(void 0),[F,M]=a.useState(!1),[S,te]=a.useState(Y),[W,oe]=a.useState(.1),H=a.useMemo(()=>N?L(t,V):{},[N,t,V,K,n]),ae=a.useMemo(()=>!C||C.loading||C.error?[]:G(t),[C]),ie=a.useMemo(()=>{const u=[];if(r||u.push("Connect you're wallet."),P||u.push("No amount."),N&&!t.isWethBond){const v=N[t?.token?.tokenAddress],A=D(v?.balanceOf,t?.token?.decimals);$>A&&u.push("Not enough balance.")}return P>H?.maxValue&&u.push(`You cannot buy as many CVGs in a single transaction, max:${k(H?.maxValue)}`),{active:u.length===0,errors:u}},[P,H?.maxValue,N]),ce=a.useMemo(()=>{if(!C||C.loading||C.error||!t?.bondParameters||t.error||t.loading)return{};const u=C.filter(j=>j.bondId===t.bondId);let v=-1;u.forEach(j=>{const Q=j.endTime-b.timestamp;!S||S.code===0?v=v===-1?Q:Math.min(Q,v):j.tokenId===S.code&&(v=Q)});let A=!v||v===-1?0:1-v/Number(t?.bondParameters?.vestingTerm);return A=A>1?1:A,{count:u?.length||0,elapsedPercent:A}},[C,S,t]),z=a.useMemo(()=>D(t.assetBondPrice,18),[]);a.useEffect(()=>{h===!0&&(f(!1),l())},[h]);const xe=()=>{M(!0)},ue=async()=>{try{const u=await c();await B.doRedeem([S?.code],n,u).then(v=>{i(v,()=>{l()})})}catch(u){d(u)}};function pe(){const u=()=>w(t.token.tokenAddress);o(t.token.tokenAddress,p.bondDepository,u).then()}const g=()=>$<=0?(d("Invalid amount"),!1):!0,y=async()=>{const u=qe(B.getCvgAmountOutMin(P,W).toString());if(!g())return;let A=be($?.toString(),t.token.decimals);const j=await c();return await(async()=>{const ge=t?.isWethBond&&V;return B.doDeposit(t.bondId,S.code,A,u,j,ge)})()},E=a.useMemo(()=>B.getCvgAmountOutMin(P,W),[P,W]),l=async()=>{J(t.bondId)},x={bondInfo:t,doDeposit:y,doRedeem:ue,isExpanded:ee,setIsExpanded:se,doApproveBond:pe,openSwapAndBond:xe,checkDeposit:g,assetValue:$,cvgValue:P,updateValue:(u,v)=>{if(u==="cvg")I(v),ne(v*z);else{const A=v/z;ne(v),I(A)}},swapAndBondVisible:F,nftOptions:ae,activePosition:S,setActivePosition:te,buyData:H,bondNftInfo:ce,slippage:W,setSlippage:oe,cvgReceivedMin:E,isDepositActive:ie,isEth:V,setIsEth:X};return e.jsx(_.Provider,{value:x,children:s})};function me({children:s}){return e.jsxs("div",{className:"cursor-pointer w-full flex-wrap  justify-content-between  lg:gap-0 md:justify-content-start grid align-items-center",children:[e.jsx("div",{className:" col-6   md:col-3  lg:col-2",children:s[0]}),e.jsx("div",{className:"col-6 md:col-3 lg:col-1 lg:mr-4",children:s[1]}),e.jsx("div",{className:"col-6  md:col-3  lg:col-2",children:s[2]}),e.jsx("div",{className:"col-6  md:col-3  lg:col-2 lg:-mr-4",children:s[3]}),e.jsx("div",{className:"col-12    md:col-6 lg:col-2",children:s[4]}),e.jsx("div",{className:"col-12  md:col-6 text-center  2  lg:col-2",children:s[5]}),e.jsx("div",{className:"col-12  lg:col-1 text-right",children:s[6]})]})}function Be({ratio:s,marksCount:t}){t=Math.round(t);const n={max:18,min:0,base:2},c={max:100,min:0},r=t>10?2:1;let i=0;r===2&&t%2!==0&&(i=c.max/(t-1)*r);const d=Array.from({length:t/r},(o,h)=>({position:i+c.max/(t-1)*h*r}));return s&&(n.current=n.max-n.max*s+n.min,c.current=c.max*s),e.jsx("div",{className:"w-full  max-w-9rem lg:max-w-7rem ",children:e.jsxs("svg",{viewBox:"0 0 100 25",className:"w-full",children:[d.map((o,h)=>e.jsx("line",{x1:o.position,y1:"0",x2:o.position,y2:n.max+n.base,stroke:"#707070"},h)),e.jsx("polygon",{className:"color-quiet",points:`${c.max},${n.min+n.base} ${c.max},${n.max+n.base} ${c.min},${n.max+n.base}`,fill:"currentColor"}),c.current&&e.jsx("polygon",{className:s==1?"color-green":"color-tonic",points:`${c.current},${n.current+n.base} ${c.current},${n.max+n.base} ${c.min},${n.max+n.base}`,fill:"currentColor"})]})})}function Qe({diff:s}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-lg",children:[s.days?s.days:s.hours," ",s.days?"days":"hours"]}),e.jsxs("div",{className:"text-sm",children:[" ",s.days?s.hours:s.minutes," ",s.days?"hours":"minutes"]})]})}function bs(){const{isExpanded:s,setIsExpanded:t,bondInfo:n,bondNftInfo:c}=a.useContext(_),{currentBlock:r}=a.useContext(R);return e.jsx("div",{className:`cursor-pointer flex flex-column md:flex-row md:justify-content-between md:align-items-center align-items-start gap-2 lg:gap-0 ${!n.isOracleValid&&"color-quiet"} `,onClick:()=>{t(!s)},children:e.jsxs(me,{children:[e.jsxs("div",{className:"flex align-items-center gap-1",children:[e.jsx("img",{src:n.url,alt:"logo",className:"staking-asset-logo w-3rem ",title:n.token.token}),e.jsx("div",{children:e.jsx("div",{className:`${n.isOracleValid?"bg-blue color-light-blue":"bg-quiet color-white"}    p-1 px-2 `,children:n.token.token})})]}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"  color-quiet lg:hidden",children:"CVG Price:"}),e.jsxs("div",{children:["$",D(n.usdBondPrice,18).toFixed(3)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"  color-quiet lg:hidden",children:"Discount:"}),e.jsxs("span",{className:`${n.isOracleValid?"bg-green color-black font-bold":"bg-quiet color-white"}  text-center w-auto   p-1 px-2 w-3rem inline-block`,children:[Number(n.actualRoi)/1e4,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:" inline-block  color-quiet lg:hidden",children:"Time left:"}),e.jsx(Qe,{diff:Re(n.bondEndTimestamp,r?.timestamp)})]}),e.jsxs("div",{className:"flex flex-column gap-1",children:[e.jsx("span",{className:" inline-block  color-quiet lg:hidden",children:"CVG available:"}),k(n?.availableCvg),"/ ",q(n?.bondParameters?.cvgToSell,18),e.jsx(Ue,{color:"var(--dapp-color-lightblue)",percent:n?.fillingPercentage,display:k(n?.fillingPercentage,!0,1),className:"max-w-20rem"})]}),e.jsxs("div",{className:"flex flex-column gap-1 text-left ",children:[e.jsx("span",{className:" inline-block  color-quiet lg:hidden",children:"Vesting:"}),e.jsx("div",{className:"inline-flex lg:mx-auto flex-wrap align-items-center gap-4 ",children:n?.isLockingMandatory?e.jsxs("div",{className:"flex align-items-center gap-2 ",children:[e.jsx("i",{className:"pi pi-lock font-bold color-tonic"}),e.jsx("span",{children:"Lock only"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-column gap-1  text-center",children:[e.jsxs("div",{children:[Math.round(n?.vestingDays)," days"]}),e.jsx(Be,{ratio:c?.elapsedPercent,marksCount:n?.vestingDays})]}),e.jsx("div",{children:e.jsxs("span",{className:"bg-blue text-xs white-space-nowrap w-fit p-1 color-light-blue",children:[c.count," pos."]})})]})})]}),e.jsxs("button",{className:"Btn Btn-nostyle",onClick:()=>{t(!s)},children:[e.jsxs("span",{className:"p-sr-only",children:[s?"Close the row":"Expand the row","/"]}),e.jsx("i",{className:`pi  color-tonic text-xl pi-chevron-${s?"up":"down"}`})]})]})})}function Ns({errors:s,label:t,disabled:n,className:c,onClick:r}){const i=a.useRef(null);return e.jsxs("div",{className:"inline-block",onMouseEnter:d=>{s?.length>0&&i?.current&&i.current.show(d)},onMouseLeave:()=>{i?.current&&i.current.hide()},children:[e.jsx("button",{onClick:r,disabled:n,className:`Btn ${c||""}`,children:t}),e.jsx(ss,{ref:i,dismissable:!0,children:e.jsx("div",{className:"relative Panel  mx-auto text-base max-w-30rem",style:{width:"90%"},children:e.jsx("div",{className:"flex flex-column",children:s?.map((d,o)=>e.jsxs("span",{className:"text-sm font-light color-quiet",children:["- ",d]},o))})})})]})}function ks(){const{ecosystemInfo:s}=a.useContext(R),{bondInfo:t,doDeposit:n,activePosition:c,cvgValue:r,assetValue:i,isDepositActive:d,isEth:o}=a.useContext(_),{resetBondAllData:h}=a.useContext(T),{openSwapAndBond:f}=a.useContext(Z),p=Ge(i,t?.token?.decimals),b=p*(t?.usdExecutionPrice||0n),N=t?.token?.token?`/images/token/${t.token.token}.webp`:$e,w=o?void 0:{contract:s?.bondDepository,token:{name:t?.token?.token,tokenAddress:t?.token?.tokenAddress}};return e.jsx(e.Fragment,{children:t.isOracleValid?e.jsxs("div",{className:"flex align-items-center",children:[!t?.isLockingMandatory&&e.jsx(_e,{processKey:"bond.deposit",allowanceDefinition:w,value:i,valueRaw:p,label:"Deposit",iconSrc:N,params:{asset:o?"ETH":t?.token?.token,tokenId:c?.code,cvgAmount:k(r,!1,4),usdValue:q(b,t?.token?.decimals+18n)},perform:n,afterPerform:()=>h(t?.bondId),disabled:!d?.active,errors:d?.errors}),e.jsx(Ns,{label:"Bond & Lock",type:"button",errors:d.errors,disabled:!d?.active,className:" vertical-align-top ",onClick:()=>f(t,i,o)})]}):e.jsx(e.Fragment,{children:e.jsx("span",{className:"bg-quiet color-white text-sm p-1",children:"Bond deactivated by oracle safety"})})})}function Ee(s){return s?s?.code===0?e.jsx("div",{className:"flex flex-column  h-full justify-content-center",children:"new"}):e.jsxs("div",{className:"flex flex-column  h-full justify-content-center",children:[e.jsxs("span",{children:["Tkn. ",Ce(s?.code)]}),e.jsxs("small",{className:"text-xs color-quiet",children:[s?.amount," CVG"]})]}):e.jsx("div",{className:"flex flex-column  h-full justify-content-center",children:"-"})}function ws(){const{isEth:s,setIsEth:t,bondInfo:n,buyData:c}=a.useContext(_),r=a.useMemo(()=>{const o=[];return o.push({name:"ETH",tokenAddress:"0x0",code:"ETH",decimals:18,amount:q(c?.ethBalance,18)}),o.push({name:"WETH",tokenAddress:ns,code:"WETH",decimals:18,amount:k(c?.tokenBalance)}),o},[n,c]),i=o=>{o.value?.code==="ETH"&&!s&&t(!0),o.value?.code==="WETH"&&s&&t(!1)},d=o=>e.jsxs("div",{className:"flex flex-column align-items-start px-1 gap-1",children:[e.jsx("div",{className:"text-sm",children:o.name}),e.jsxs("span",{className:`text-xs ${o.amount===0n?"inactive":""}`,children:["Av.: ",o.amount]})]});return e.jsx("div",{className:"my-2",children:e.jsx(ye,{itemTemplate:d,unselectable:!1,className:"inline-block massive",optionLabel:"name",value:s?r[0]:r[1],options:r,onChange:i})})}function Cs(){const{bondInfo:s,assetValue:t,cvgValue:n,updateValue:c,buyData:r,activePosition:i,setActivePosition:d,nftOptions:o,isEth:h}=a.useContext(_),{address:f}=U(),p=s?.token?.token;let b=s.token.token.toUpperCase()==="CRV"?ke:`/images/token/${s.token.token}.webp`;b=s.isWethBond&&h?"/images/token/ETH.webp":b;const N=()=>{c("cvg",r?.maxValue)};return e.jsxs("div",{children:[!!s.isWethBond&&e.jsx("div",{className:"mb-4",children:e.jsx(ws,{})}),e.jsx("div",{className:"text-xs mb-1",children:"Deposit:"}),e.jsxs("div",{className:"flex flex-wrap align-items-center mb-2 gap-2",children:[e.jsx("img",{src:b,alt:"logo",className:"staking-asset-logo w-2rem ",title:p}),e.jsx("div",{className:"",children:e.jsx(Ne,{inputId:"max-buttons",className:"appearance-none ",value:t,onChange:w=>{c("asset",w.value)},onFocus:()=>{t===0&&c("asset","")},placeholder:"Enter "+(s.isWethBond&&h?"ETH":p)+" amount",mode:"decimal",minFractionDigits:2,maxFractionDigits:10,locale:"en-US"})}),e.jsxs("div",{className:"flex lg:flex-column lg:align-items-start align-items-center",children:[e.jsxs("span",{className:"text-sm white-space-nowrap",children:[" Available: ",k(r?.availableAmount)]}),e.jsx(He,{className:"ml-0 p-0",available:r?.availableAmount,setValue:N})]})]}),e.jsx("div",{className:"text-xs mb-1",children:"Receive:"}),e.jsxs("div",{className:"flex flex-wrap align-items-center gap-2 ",children:[e.jsx("img",{src:ts,alt:"logo",className:"staking-asset-logo w-2rem ",title:s.token.token}),e.jsx(Ne,{inputId:"max-buttons",className:"appearance-none ",value:n,onChange:w=>{c("cvg",w.value)},placeholder:"Enter CVG Amount",mode:"decimal",minFractionDigits:2,maxFractionDigits:10,locale:"en-US"}),!!f&&e.jsx(Ye,{className:"input w-10rem  text-sm md:align-self-end align-self-center no-padding",itemTemplate:Ee,valueTemplate:Ee,id:"bond-position",value:i,options:o,onChange:w=>{d(w.value)},optionLabel:"name"})]})]})}function ys(){const{bondInfo:s,isExpanded:t,setSlippage:n,cvgReceivedMin:c}=a.useContext(_),{ecosystemInfo:r}=a.useContext(R),{address:i}=U();if(!s||!t||s.loading)return e.jsx("div",{children:e.jsx(O,{className:"h-4rem px-4"})});const d=s?.token?.token;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap justify-content-between mt-4 gap-6 align-items-stretch h-full ",children:[e.jsx("div",{className:"flex  justify-content-center",children:e.jsx("div",{className:"",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex md:flex-row flex-column gap-1",children:e.jsx(Cs,{})}),e.jsxs("div",{className:"text-xs mt-2 color-quiet",children:["Minimum receive: ",k(c)," CVG"]}),!!i&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex flex-column gap-1",children:[e.jsxs("div",{className:"flex gap-2 align-items-center",children:[e.jsxs(ze,{children:[e.jsx("span",{className:"color-tonic",children:" Slippage tolerance "})," is a setting for the amount of price slippage you are willing to accept for a bond.",e.jsx("br",{}),e.jsx("br",{}),"By setting slippage tolerance, you're basically setting"," ",e.jsx("span",{className:"color-tonic",children:" a minimum amount "})," on how many tokens you will accept, in the event that the price or discount increases or decreases."]}),e.jsx("span",{className:"text-xs",children:" Slippage tolerance: "})]}),e.jsx(Ke,{setSlippage:n})]})})]})})}),e.jsx("div",{className:" wrap-600px",children:e.jsxs(xs,{tabs:["About","Contracts"],className:"flex flex-wrap h-full  align-content-center gap-3",children:[e.jsx("div",{className:"h-full  flex-wrap flex  align-content-center ",children:e.jsxs("span",{children:[s?.isLockingMandatory?e.jsxs(e.Fragment,{children:[" ","Deposit ",e.jsxs("span",{className:"color-tonic",children:[d," "]})," to buy discounted CVG. Your tokens will be locked for a minimum period of 36 weeks.",e.jsx("br",{})," ",e.jsx("br",{})]}):e.jsxs(e.Fragment,{children:[" ","Deposit ",e.jsx("span",{className:"color-tonic",children:d})," to buy discounted CVG. Your tokens will be linearly available, according to the bond vesting period.",e.jsx("br",{})," ",e.jsx("br",{})]}),"Max buyout: ",k(s?.maxBondAtOneTime)," CVG"]})}),e.jsxs("div",{className:"flex flex-wrap h-full align-content-center gap-3 ",children:[e.jsx(re,{className:"flex-basis-30",contract:{address:r.bondDepository,name:"BondDepository"}}),e.jsx(re,{className:"flex-basis-30",contract:{address:s.token.tokenAddress,name:d}}),e.jsx(re,{className:"flex-basis-30",contract:{address:r.bondCalculator,name:"BondCalculator"}}),s.poolAddress!==as&&e.jsx(re,{className:"flex-basis-30",contract:{address:s.poolAddress,name:"PoolPriceBased"}}),e.jsx(re,{className:"flex-basis-30",contract:{address:r.cvgOracle,name:"CvgOracle"}})]})]})})]}),e.jsx("div",{className:"mt-5",children:e.jsx(ks,{})})]})}function Bs(){const{bondInfo:s}=a.useContext(_),{currentBlock:t}=a.useContext(R);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"border-quiet py-3 border-top-1",children:e.jsxs(me,{children:[e.jsxs("div",{className:"flex align-items-center gap-1",children:[e.jsx("img",{src:s.url,alt:"logo",className:"staking-asset-logo w-3rem ",title:s.token.token}),e.jsx("div",{className:"bg-blue color-light-blue  p-1 px-2 ",children:s.token.token})]}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"  color-quiet lg:hidden",children:"CVG Price:"}),e.jsxs("div",{children:["$",D(s.usdBondPrice,18).toFixed(3)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"  color-quiet lg:hidden",children:"Discount:"}),e.jsxs("span",{className:`${s.isOracleValid?"bg-green color-black font-bold":"bg-quiet color-white"}  text-center w-auto   p-1 px-2 w-3rem inline-block`,children:[Number(s.actualRoi)/1e4,"%"]})]}),e.jsxs("div",{className:"color-quiet",children:["Coming Soon",e.jsx(Qe,{diff:Re(s.startBondTimestamp,t?.timestamp)})]}),e.jsxs("div",{className:"flex flex-column gap-1",children:[e.jsx("span",{className:" inline-block  color-quiet lg:hidden",children:"CVG available:"}),k(s?.availableCvg),"/ ",q(s?.bondParameters?.cvgToSell,18),e.jsx(Ue,{color:"var(--dapp-color-lightblue)",percent:s?.fillingPercentage,display:k(s?.fillingPercentage,!0,1),className:"max-w-20rem"})]}),e.jsx("div",{className:"flex flex-column gap-1 xl:flex-row justify-content-evenly align-items-center",children:e.jsx("div",{className:"flex flex-column gap-1 md:w-8rem text-center",children:s?.isLockingMandatory?e.jsxs("div",{className:"flex align-items-center gap-2 ",children:[e.jsx("i",{className:"pi pi-lock font-bold color-tonic"}),e.jsx("span",{children:"Lock only"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[Math.round(s?.vestingDays)," days"]}),e.jsx(Be,{marksCount:s?.vestingDays})]})})}),e.jsx(e.Fragment,{})]})})})}function As(){const{isExpanded:s,bondInfo:t}=a.useContext(_);return t?.isFuture?e.jsx(Bs,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-quiet pt-3 pb-1 border-top-1",children:[e.jsx(bs,{}),e.jsx("div",{className:"w-full",hidden:!s,children:e.jsx(ys,{})})]})})}function Ds(){const{bondInfo:s,bondInValue:t,updateBondInAmount:n,buyData:c,getCvgAmount:r,setSlippage:i,cvgReceivedMin:d,isEth:o}=a.useContext(Z),h=s?.token;function f(){const p=C=>{n(C.value)},b=()=>{n(c?.maxAssetValue)},N=Te(p,500),w=Te(b,500);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2  justify-content-between mb-4 flex-column ",children:[e.jsxs("div",{className:"text-xl mb-2 flex flex-column   ",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap mb-3",children:["Buy ",e.jsx("span",{className:"color-tonic",children:"CVG"})," with ",e.jsx("span",{className:"color-tonic",children:o?"ETH":h?.token}),e.jsx("div",{className:"white-space-nowrap",children:e.jsxs("span",{className:"bg-green color-black font-bold p-2 py-1",children:["Discount: ",Number(s.actualRoi)/1e4,"%"]})})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap align-items-center gap-2",children:[e.jsx("img",{src:o?"/images/token/ETH.webp":s.url,alt:"logo",className:"staking-asset-logo w-2rem ",title:o?"ETH":s.token.token}),e.jsx(Ne,{value:t,onChange:N,mode:"decimal",minFractionDigits:2}),e.jsxs("div",{className:"flex  align-items-center lg:align-items-start  lg:flex-column gap-1",children:[e.jsx(He,{setValue:w,available:c?.availableAmount}),e.jsxs("small",{className:"text-sm block",children:["balance: ",k(c.availableAmount)," "]})]})]}),e.jsxs("div",{className:"text-xs mt-2 color-quiet",children:["Minimum receive: ",k(d)," CVG"]})]}),e.jsxs("div",{className:"flex flex-column gap-1",children:[e.jsxs("span",{className:"text-sm flex gap-2 ",children:[e.jsxs(ze,{children:[e.jsx("span",{className:"color-tonic",children:" Slippage tolerance "})," is a setting for the amount of price slippage you are willing to accept for a bond.",e.jsx("br",{}),e.jsx("br",{}),"By setting slippage tolerance, you're basically setting ",e.jsxs("span",{className:"color-tonic",children:[" ","a minimum amount"," "]})," ","on how many tokens you will accept, in the event that the price or discount increases or decreases."]}),"Slippage tolerance:"]}),e.jsx(Ke,{setSlippage:i})]})]}),e.jsxs("div",{className:"flex flex-column mt-auto gap-3 ",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("i",{className:"pi pi-info-circle color-tonic"}),e.jsx("p",{children:"There is no vesting period as you will lock your CVG for a period which you can choose in the “Lock” screen hereafter."})]}),e.jsx("div",{className:"border-top-1 border-quiet py-3",children:e.jsxs("div",{className:"flex gap-2 align-items-center",children:[e.jsx("span",{children:"Bond:"}),e.jsxs("div",{className:"info-block",children:[k(t||0)," ",o?"ETH":s?.token?.token||"-"]}),e.jsxs("div",{className:"color-quiet",children:[k(r())||0," CVG"]})]})})]})]})}return e.jsx(e.Fragment,{children:f()})}function Vs(){const{getCvgAmount:s}=a.useContext(Z),{lockParams:t}=a.useContext(ve);return e.jsxs("div",{className:"flex flex-column gap-2 border-top-1 border-quiet py-3",children:[!t?.existingPosition&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex align-items-center  gap-2",children:[e.jsx("span",{className:"w-5rem",children:"Lock:"}),e.jsxs("div",{className:"info-block",children:[k(s())||0," CVG"]})]}),e.jsxs("div",{className:"flex align-items-center  gap-2",children:[e.jsx("span",{className:"w-5rem",children:"For:"}),e.jsxs("div",{className:"info-block",children:[t?.timeOption.code," weeks"]})]}),e.jsxs("div",{className:"flex align-items-center  gap-2",children:[e.jsx("span",{className:"w-5rem",children:"Rep:"}),e.jsxs("div",{className:"info-block",children:[e.jsxs("span",{className:"color-ysCvg",children:[t?.repartition,"% ysCVG "]})," /"," ",e.jsxs("span",{className:"color-veCvg",children:[100-t?.repartition,"% veCVG"]})]})]})]}),t?.existingPosition&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex align-items-center  gap-2",children:[e.jsx("span",{className:"w-5rem",children:"token:"}),e.jsxs("div",{className:"info-block",children:["tknId ",Ce(Number(t?.existingPosition?.tokenId))]})]}),e.jsxs("div",{className:"flex align-items-center  gap-2",children:[e.jsx("span",{className:"w-5rem",children:"amount:"}),e.jsxs("div",{className:"info-block",children:[k(s())||0," CVG"]})]}),e.jsxs("div",{className:"flex align-items-center  gap-2",children:[e.jsx("span",{className:"w-5rem",children:"time:"}),e.jsxs("div",{className:"info-block",children:[t?.timeOption.code," weeks"]})]})]})]})}function Ss(){const{isWellConnected:s}=U(),{lockInfo:t,lockParams:n,loadStaticData:c,timeOptions:r,updateLockParams:i}=a.useContext(ve),{updateSelectLockPosition:d,selectedLockPosition:o,getLockPositionsOptions:h}=a.useContext(Z);a.useEffect(()=>{s&&t===void 0&&c()});function f(){return e.jsxs("div",{className:"flex gap-2  justify-content-between flex-column ",children:[e.jsxs("div",{className:"flex flex-column gap-2 h-full",children:[e.jsxs("div",{className:"flex flex-column gap-1",children:[e.jsx("label",{className:"block  text-sm",htmlFor:"lock-position",children:"Lock position:"}),e.jsx(Ye,{id:"lock-position",value:o,className:"max-w-15rem no-padding ",options:h(),onChange:p=>{d(p.value)},itemTemplate:Le,valueTemplate:Le,optionLabel:"code"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 align-items-center",children:[e.jsxs("div",{className:"flex flex-column gap-1",children:[e.jsx("label",{className:"block text-sm",htmlFor:"lock-duration",children:"Duration/Increase (in weeks):"}),e.jsx(ye,{id:"lock-duration",unselectable:!1,className:"flex flex-wrap gap-1 full-border text-sm ",optionLabel:"name",value:n?.timeOption,options:r,onChange:p=>i("timeOption",p.value)})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex flex-column gap-1",children:[e.jsx("span",{className:"text-sm",children:"CVG available on: "}),e.jsx("span",{className:"info-block",children:n?.end?.toLocaleString()||"-"})]})})]}),e.jsx("div",{children:o?.code===0?e.jsx(ds,{value:n?.repartition,className:"max-w-25rem",boundaries:[0,100],step:10,onChange:p=>{i("repartition",p)}}):e.jsxs("div",{children:["Repartition:",e.jsxs("div",{className:"Form-blue-input  inline-block",children:[e.jsxs("span",{className:"color-tonic",children:[n?.repartition,"% "]}),"ysCVG /"," ",e.jsxs("span",{className:"color-light-blue",children:[100-n?.repartition,"% "]})," veCVG"]})]})})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsxs("div",{className:"flex gap-2 py-4",children:[e.jsx("i",{className:"pi pi-info-circle color-tonic"}),e.jsx("p",{children:"Locking is irreversible. Your CVG can not be redeemed before the end of the lock period."})]}),e.jsx(Vs,{})]})]})}return e.jsx(e.Fragment,{children:f()})}function Ps(){const{ecosystemInfo:s}=a.useContext(R),{resetBondAllData:t}=a.useContext(T),{swapAndBondVisible:n,setSwapAndBondVisible:c,doBondAndLock:r,bondInfo:i,selectedLockPosition:d,getCvgAmount:o,bondInValue:h,isDepositActive:f,isEth:p}=a.useContext(Z),{lockParams:b}=a.useContext(ve),N=Ge(h,i?.token?.decimals),w=N*(i?.usdExecutionPrice||0n),C=p?void 0:{contract:s?.bondDepository,token:{name:i?.token?.token,tokenAddress:i?.token?.tokenAddress}};return e.jsx(We,{header:"Bond & Lock",visible:n,style:{width:"90vw"},closable:!0,closeOnEscape:!0,onHide:()=>c(!1),dismissableMask:!1,children:e.jsxs(we,{className:" overflow-hidden",children:[e.jsxs("div",{className:"grid mt-4 gap-4",children:[e.jsx(Se,{legendClassName:"color-quiet",legend:"Bond ",className:"col flex flex-column  ",children:e.jsx(Ds,{})}),e.jsx(Se,{legendClassName:"color-quiet",legend:"Lock ",className:"col",children:e.jsx(Ss,{})})]}),e.jsx("div",{className:" mt-4 text-right ",children:e.jsx(_e,{processKey:"bond.depositAndLock",allowanceDefinition:C,className:"text-2xl",value:h,valueRaw:N,label:"Deposit",params:{asset:p?"ETH":i?.token?.token,tokenId:d?.code,cvgAmount:k(o()),lockDuration:b?.duration,usdValue:q(w,(i?.token?.decimals||0n)+18n)},perform:r,afterPerform:()=>t(i?.bondId),disabled:!f?.active,errors:f?.errors})})]})})}function Ts(){const{bondList:s,updateFilter:t,filter:n}=a.useContext(T);if(s?.error)return e.jsx("div",{className:"mb-6",children:e.jsx(we,{children:e.jsx(rs,{})})});const c=Object.entries(s||{});function r(i){t("sort",i)}return e.jsx(e.Fragment,{children:e.jsx(ms,{minCycle:36,children:e.jsxs(js,{children:[e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"hidden lg:flex",children:e.jsxs(me,{children:[e.jsx("div",{className:"color-quiet p-2 py-1",children:"Asset name"}),e.jsx(de,{onSort:r,field:"price",label:"CVG Price",filter:n}),e.jsx(de,{onSort:r,field:"roi",label:"Discount",filter:n}),e.jsx(de,{onSort:r,field:"timeleft",label:"Time",filter:n}),e.jsx(de,{onSort:r,field:"available",label:"CVG Available",filter:n}),e.jsx(de,{onSort:r,field:"vesting",label:"Vesting period",filter:n})]})}),s===void 0||s?.loading?e.jsx(O,{className:"w-full h-4rem p-1 m-1"}):c?.length===0?e.jsx("div",{className:"flex justify-content-center h-10rem align-items-center",children:"No bond available at the moment."}):c.map(([,i],d)=>e.jsx(vs,{bondInfo:i,children:e.jsx(As,{})},d))]}),e.jsx(Ps,{})]})})})}function Ze({children:s,onClick:t=void 0,className:n=void 0}){return e.jsxs("div",{className:`cursor-pointer  justify-content-between grid align-items-center border-bottom-1 border-quiet pt-1 mb-1 ${n||""}`,onClick:t,children:[e.jsx("div",{className:"col-6 md:col-4 lg:col-1",children:s[0]}),e.jsx("div",{className:"col-6 md:col-4 lg:col-2",children:s[1]}),e.jsx("div",{className:"col-6 md:col-4 lg:col-2",children:s[2]}),e.jsx("div",{className:"col-6 md:col-4 lg:col-2",children:s[3]}),e.jsx("div",{className:"col-6 md:col-4 lg:col-2",children:s[4]}),e.jsx("div",{className:"col-6 md:col-4 lg:col-2",children:s[5]})]})}function Ls({token:s,toggle:t,selected:n}){const{initialBondList:c}=a.useContext(T),{currentBlock:r}=a.useContext(R),i=n.includes(s?.tokenId),d=a.useMemo(()=>{if(!c||!r)return{};let h=c?.find(C=>C.bondId===s.bondId),f=h?.token?.token;const p=s.endTime-r.timestamp;let b=p<=0?1:1-p/Number(h?.bondParameters?.vestingTerm),N,w;return h?(N=h?.token?.token.toUpperCase()==="CRV"?ke:`/images/token/${h?.token?.token.toUpperCase()}.webp`,w=Math.round(h?.vestingDays)):(f=`BondId: ${s.bondId}`,w="-",N=$e,b=100),{elapsedPercent:b,sourceToken:f,url:N,bondInfo:h,vestingDays:w}},[s,c]),o=()=>{t(s.tokenId)};return e.jsxs(Ze,{onClick:o,className:`${i&&"bg-green-fade"}`,children:[e.jsx("div",{className:" flex align-items-center lg:justify-content-center p-2 lg:p0",children:e.jsx("img",{className:"w-2rem",src:`/images/icon/check-${i?"selected":"none"}.svg`,alt:"row selected"})}),e.jsxs("div",{className:"flex gap-2 align-items-center p-2 lg:p0",children:[e.jsx("img",{src:d?.url,alt:"logo",className:"staking-asset-logo w-2rem ",title:d.sourceToken}),e.jsx("div",{className:"bg-blue color-light-blue  p-1 px-2 ",children:d.sourceToken})]}),e.jsxs("div",{className:"flex flex-column  gap-1 p-2 lg:p0",children:[e.jsx("span",{className:" mx-1 color-quiet lg:hidden",children:"Token:"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{children:"Tkn."}),e.jsxs("div",{children:[" ",Ce(s.tokenId)]})]})]}),e.jsxs("div",{className:"p-2 lg:p0",children:[e.jsx("span",{className:" inline-block mx-1 color-quiet lg:hidden",children:"Vesting:"}),e.jsxs("div",{children:[d.vestingDays," days"]}),e.jsx(Be,{marksCount:d?.bondInfo?.vestingDays,ratio:d?.elapsedPercent})]}),e.jsxs("div",{className:"p-2 lg:p0",children:[e.jsx("span",{className:" inline-block mx-1 color-quiet lg:hidden",children:"Redeemable CVG:"}),e.jsxs("div",{className:`p-1 white-space-nowrap text-right w-9rem lg:w-auto xl:w-9rem   text-lg lg:text-base xl:text-lg font-semibold 
                    ${d?.elapsedPercent>=1?"bg-green":"bg-tonic"} color-black`,children:[k(s.claimable,!0,0)," -",e.jsx("span",{className:"text-xs",children:"CVG"})]})]}),e.jsxs("div",{className:"p-2 lg:p0",children:[e.jsx("span",{className:" inline-block mx-1 color-quiet lg:hidden",children:"Remaining CVG:"}),e.jsxs("div",{className:"p-1 white-space-nowrap text-right w-9rem lg:w-auto xl:w-9rem  text-lg lg:text-base xl:text-lg  info-block",children:[k(s.leftClaimable-s.claimable)," ",e.jsx("span",{className:"text-xs",children:"CVG"})]})]})]})}function Is(){const{claimAllVisible:s,setClaimAllVisible:t,bondUserData:n,doClaimAll:c}=a.useContext(T),[r,i]=a.useState([]);if(!n||n.loading||n?.error)return e.jsx(e.Fragment,{});const d=o=>{r.includes(o)?i(r.filter(h=>h!==o)):i([...r,o])};return!n||n.loading||n?.error?e.jsx(e.Fragment,{}):e.jsx(We,{header:"Redeem bonds",closable:!0,visible:s,style:{width:"80vw"},breakpoints:{"960px":"90vw","641px":"96vw"},onHide:()=>t(!1),dismissableMask:!1,children:e.jsxs("div",{className:"overflow-hidden mt-4 mb-4",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsxs(Ze,{className:"color-quiet  ",children:[e.jsx("div",{}),e.jsx("span",{children:"Token"}),e.jsx("span",{children:"Position"}),e.jsx("span",{children:"Vesting period"}),e.jsx("span",{children:"Redeemable CVG"}),e.jsx("span",{children:"Remaining CVG"})]})}),n?.filter(o=>o.isClaimable).map(o=>e.jsx(Ls,{token:o,toggle:d,selected:r},o.tokenId)),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-sm",children:[" ",r.length," selected position(s)"]}),e.jsx(Me,{className:"Btn",disabled:r.length===0,onClick:()=>c(r),children:"Claim selected rows"})]})]})})}function Es({bondInfo:s}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"border-quiet pt-3 pb-1 border-top-1",children:e.jsx("div",{className:`cursor-pointer flex flex-column md:flex-row md:justify-content-between md:align-items-center align-items-start gap-2 lg:gap-0 
                  color-quiet`,children:e.jsxs(me,{children:[e.jsxs("div",{className:"flex align-items-center gap-1",children:[e.jsx("img",{src:s.url,alt:"logo",className:" staking-asset-logo w-3rem ",title:s.token.token}),e.jsx("div",{children:e.jsx("div",{className:"bg-quiet text-white    p-1 px-2",children:s.token.token})})]}),e.jsx("div",{className:"",children:"-"}),e.jsx("div",{children:"-"}),e.jsx("div",{children:"- "}),e.jsx("div",{className:"flex flex-column gap-1",children:e.jsxs("div",{className:"color-quiet",children:[k(s?.availableCvg)," / ",q(s?.bondParameters?.cvgToSell,18)]})}),e.jsxs("div",{className:"flex flex-column gap-1 text-left ",children:[e.jsx("span",{className:" inline-block  color-quiet lg:hidden",children:"Vesting:"}),e.jsx("div",{className:"inline-flex lg:mx-auto flex-wrap align-items-center gap-4 ",children:e.jsx("div",{className:"flex flex-column gap-1  text-center",children:e.jsxs("div",{children:[Math.round(s?.vestingDays)," days"]})})})]}),e.jsx("span",{children:"-"})]})})})})}function Fs(){const{concludedBondList:s}=a.useContext(T);return s?.length?e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"hidden lg:flex",children:e.jsxs(me,{children:[e.jsx("span",{className:"color-quiet p-2 py-1",children:"Asset name"}),e.jsx("span",{className:"color-quiet",children:"-"}),e.jsx("span",{className:"color-quiet",children:"-"}),e.jsx("span",{className:"color-quiet",children:"Time"}),e.jsx("span",{className:"color-quiet",children:"CVG Available"}),e.jsx("span",{className:"color-quiet",children:"Vesting"}),e.jsx("span",{className:"color-quiet",children:"-"})]})}),s===void 0||s?.loading?e.jsx(O,{className:"w-full h-4rem p-1 m-1"}):Object.entries(s).map(([,t],n)=>e.jsx(Es,{bondInfo:t},n))]}):e.jsx("div",{className:"flex justify-content-center h-10rem align-items-center",children:"No data "})}const Ms=[{code:"open",name:"Open Bonds"},{code:"concluded",name:"Concluded Bonds"}];function Os(){const s=()=>{};return e.jsxs(hs,{options:Ms,callBacks:[null,s],children:[e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"mb-4"}),e.jsx(Ts,{}),e.jsx(Is,{})]}),e.jsx(e.Fragment,{children:e.jsx(Fs,{})})]})}function qs(){return e.jsxs(ps,{children:[e.jsx(gs,{className:"mb-4 w-12"}),e.jsx(Os,{})]})}function cn(){return e.jsx("main",{className:"flex justify-content-center",children:e.jsx(ls,{children:e.jsx(qs,{})})})}export{cn as default};
