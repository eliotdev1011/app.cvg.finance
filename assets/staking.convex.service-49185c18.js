import{c as p,a as k,b as w,S as A,d as S}from"./staking.stakedao.service-87aa0857.js";import{B as m,s as b,a5 as r,d,aO as C,a2 as x,b as h,ar as P,as as T,a4 as I}from"./index-614b6d1c.js";import{c as R}from"./CvxAssetStakingService-f8fb6638.js";import{c as y}from"./CurvePool-852682be.js";import{g as V}from"./convexUtils-7f054622.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[e]="b89cc648-2d29-4a36-803c-ec62bb83225b",i._sentryDebugIdIdentifier="sentry-dbid-b89cc648-2d29-4a36-803c-ec62bb83225b")}catch{}})();const _="hh-sol-artifact-1",N="CvxStakingProcessableRewards",L="contracts/ChainView/CvxStakingProcessableRewards.sol",O=[{inputs:[{internalType:"contract ICvxStakingPositionService",name:"cvgCvxStakingService",type:"address"},{internalType:"contract ICvgCVX",name:"cvgCVX",type:"address"},{internalType:"contract ICvxStakingPositionService[]",name:"cvxStakings",type:"address[]"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{components:[{internalType:"address",name:"stakingContract",type:"address"},{internalType:"string",name:"stakingName",type:"string"},{internalType:"bool",name:"isCvxProcessed",type:"bool"},{components:[{internalType:"contract IERC20",name:"token",type:"address"},{internalType:"uint256",name:"totalProcessable",type:"uint256"},{internalType:"uint256",name:"processorAmount",type:"uint256"},{internalType:"uint256",name:"podAmount",type:"uint256"},{internalType:"uint256",name:"stakerAmount",type:"uint256"}],internalType:"struct TokenAmountsProcessed[]",name:"tokenAmounts",type:"tuple[]"}],internalType:"struct CvxHarvesterInfo[]",name:"harvesterInfos",type:"tuple[]"}],name:"CvxStakingProcessableRewardsErr",type:"error"}],j="0x608060405234801561000f575f80fd5b506040516110f63803806110f683398101604081905261002e91610be5565b610039838383610041565b5050506110ac565b5f600173b0afc8363b8f36e0cce5d54251e20720ffaeaee76001600160a01b031663763b24656040518163ffffffff1660e01b8152600401602060405180830381865afa158015610094573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906100b89190610ca7565b6100c29190610ce8565b6001600160801b031690505f825160016100dc9190610d0f565b6001600160401b038111156100f3576100f3610b57565b60405190808252806020026020018201604052801561014657816020015b604080516080810182525f80825260606020830181905292820152818101919091528152602001906001900390816101115790505b5090505f5b83518110156106b9575f84828151811061016757610167610d28565b60200260200101516001600160a01b031663edaafe206040518163ffffffff1660e01b8152600401602060405180830381865afa1580156101aa573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906101ce9190610d3c565b9050806001600160a01b031663b636a15a6040518163ffffffff1660e01b8152600401602060405180830381865afa15801561020c573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906102309190610d3c565b604051630c00007b60e41b81526001600160a01b038381166004830152919091169063c00007b0906024015f604051808303815f87803b158015610272575f80fd5b505af1158015610284573d5f803e3d5ffd5b505050505f816001600160a01b0316633e0e5c466040518163ffffffff1660e01b81526004015f60405180830381865afa1580156102c4573d5f803e3d5ffd5b505050506040513d5f823e601f3d908101601f191682016040526102eb9190810190610d71565b90505f81516001600160401b0381111561030757610307610b57565b60405190808252806020026020018201604052801561036e57816020015b61035b6040518060a001604052805f6001600160a01b031681526020015f81526020015f81526020015f81526020015f81525090565b8152602001906001900390816103255790505b5090505f5b8251811015610545575f83828151811061038f5761038f610d28565b6020908102919091010151805160405163fd87499560e01b81526001600160a01b03808316600483015292935090915f919088169063fd87499590602401602060405180830381865afa1580156103e8573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061040c9190610e3e565b6040516370a0823160e01b81526001600160a01b0389811660048301528416906370a0823190602401602060405180830381865afa158015610450573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906104749190610e3e565b61047e9190610e55565b90505f620186a0846020015165ffffffffffff168361049d9190610e68565b6104a79190610e7f565b90505f620186a0856040015165ffffffffffff16846104c69190610e68565b6104d09190610e7f565b90506040518060a00160405280856001600160a01b0316815260200184815260200183815260200182815260200182848661050b9190610e55565b6105159190610e55565b81525087878151811061052a5761052a610d28565b60200260200101819052508560010195505050505050610373565b50604051806080016040528088868151811061056357610563610d28565b60200260200101516001600160a01b0316815260200188868151811061058b5761058b610d28565b60200260200101516001600160a01b03166395d89b416040518163ffffffff1660e01b81526004015f60405180830381865afa1580156105cd573d5f803e3d5ffd5b505050506040513d5f823e601f3d908101601f191682016040526105f49190810190610ec0565b815260200188868151811061060b5761060b610d28565b60200260200101516001600160a01b03166344f79609896040518263ffffffff1660e01b815260040161064091815260200190565b606060405180830381865afa15801561065b573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061067f9190610f4e565b6040015115158152602001828152508585815181106106a0576106a0610d28565b602002602001018190525083600101935050505061014b565b506106c5858584610713565b81600183516106d49190610e55565b815181106106e4576106e4610d28565b60200260200101819052508060405163a4e2481360e01b815260040161070a9190610f92565b60405180910390fd5b604080516080810182525f80825260606020830181905292820152818101919091525f836001600160a01b0316633e0e5c466040518163ffffffff1660e01b81526004015f60405180830381865afa158015610771573d5f803e3d5ffd5b505050506040513d5f823e601f3d908101601f191682016040526107989190810190610d71565b90505f81516001600160401b038111156107b4576107b4610b57565b60405190808252806020026020018201604052801561081b57816020015b6108086040518060a001604052805f6001600160a01b031681526020015f81526020015f81526020015f81526020015f81525090565b8152602001906001900390816107d25790505b5090505f5b8251811015610a8f575f83828151811061083c5761083c610d28565b6020908102919091010151805160405163fd87499560e01b81526001600160a01b03808316600483015292935090915f91908a169063fd87499590602401602060405180830381865afa158015610895573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906108b99190610e3e565b6040516370a0823160e01b81526001600160a01b038b811660048301528416906370a0823190602401602060405180830381865afa1580156108fd573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906109219190610e3e565b61092b9190610e55565b9050734e3fbd56cd56c3e72c1403e103b45db9da5b9d2b6001600160a01b0316835f01516001600160a01b0316036109ca57886001600160a01b031663d438ce726040518163ffffffff1660e01b8152600401602060405180830381865afa158015610999573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906109bd9190610e3e565b6109c79082610e55565b90505b5f620186a0846020015165ffffffffffff16836109e79190610e68565b6109f19190610e7f565b90505f620186a0856040015165ffffffffffff1684610a109190610e68565b610a1a9190610e7f565b90506040518060a00160405280856001600160a01b03168152602001848152602001838152602001828152602001828486610a559190610e55565b610a5f9190610e55565b815250878781518110610a7457610a74610d28565b60200260200101819052508560010195505050505050610820565b50604080516080810182526001600160a01b0388168082528251808401845260068152650c6ecce86acb60d31b60208083019190915283015282516344f7960960e01b81526004810188905291928301916344f7960990602401606060405180830381865afa158015610b04573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610b289190610f4e565b60400151151581526020019190915295945050505050565b6001600160a01b0381168114610b54575f80fd5b50565b634e487b7160e01b5f52604160045260245ffd5b604051606081016001600160401b0381118282101715610b8d57610b8d610b57565b60405290565b604051601f8201601f191681016001600160401b0381118282101715610bbb57610bbb610b57565b604052919050565b5f6001600160401b03821115610bdb57610bdb610b57565b5060051b60200190565b5f805f60608486031215610bf7575f80fd5b8351610c0281610b40565b80935050602080850151610c1581610b40565b60408601519093506001600160401b03811115610c30575f80fd5b8501601f81018713610c40575f80fd5b8051610c53610c4e82610bc3565b610b93565b81815260059190911b82018301908381019089831115610c71575f80fd5b928401925b82841015610c98578351610c8981610b40565b82529284019290840190610c76565b80955050505050509250925092565b5f60208284031215610cb7575f80fd5b81516001600160801b0381168114610ccd575f80fd5b9392505050565b634e487b7160e01b5f52601160045260245ffd5b6001600160801b03828116828216039080821115610d0857610d08610cd4565b5092915050565b80820180821115610d2257610d22610cd4565b92915050565b634e487b7160e01b5f52603260045260245ffd5b5f60208284031215610d4c575f80fd5b8151610ccd81610b40565b805165ffffffffffff81168114610d6c575f80fd5b919050565b5f6020808385031215610d82575f80fd5b82516001600160401b03811115610d97575f80fd5b8301601f81018513610da7575f80fd5b8051610db5610c4e82610bc3565b81815260609182028301840191848201919088841115610dd3575f80fd5b938501935b83851015610e325780858a031215610dee575f80fd5b610df6610b6b565b8551610e0181610b40565b8152610e0e868801610d57565b878201526040610e1f818801610d57565b9082015283529384019391850191610dd8565b50979650505050505050565b5f60208284031215610e4e575f80fd5b5051919050565b81810381811115610d2257610d22610cd4565b8082028115828204841417610d2257610d22610cd4565b5f82610e9957634e487b7160e01b5f52601260045260245ffd5b500490565b5f5b83811015610eb8578181015183820152602001610ea0565b50505f910152565b5f60208284031215610ed0575f80fd5b81516001600160401b0380821115610ee6575f80fd5b818401915084601f830112610ef9575f80fd5b815181811115610f0b57610f0b610b57565b610f1e601f8201601f1916602001610b93565b9150808252856020828501011115610f34575f80fd5b610f45816020840160208601610e9e565b50949350505050565b5f60608284031215610f5e575f80fd5b610f66610b6b565b825181526020830151602082015260408301518015158114610f86575f80fd5b60408201529392505050565b5f6020808301818452808551808352604092508286019150828160051b8701018488015f5b8381101561109e57888303603f19018552815180516001600160a01b0390811685528882015160808a8701819052815190870181905260a0610ffe82828a01858f01610e9e565b848b015115158b890152606094850151601f92909201601f191688018881038201868a01528251828201818152938e01965f95509160c001905b8086101561108157875194508685511682528e8501518f8301528d8501518e83015282850151838301526080850151608083015283820191508e88019750600186019550611038565b509a8d019a98505050948a01945050506001919091019050610fb7565b509098975050505050505050565b603e806110b85f395ff3fe60806040525f80fdfea26469706673582212203d1dc0a3bf6e16d7da400c098ad9acbc0b2b859fdb61a405817dd9be5f98e05064736f6c63430008180033",B="0x60806040525f80fdfea26469706673582212203d1dc0a3bf6e16d7da400c098ad9acbc0b2b859fdb61a405817dd9be5f98e05064736f6c63430008180033",E={},H={},l={_format:_,contractName:N,sourceName:L,abi:O,bytecode:j,deployedBytecode:B,linkReferences:E,deployedLinkReferences:H};class D{bcService=new m;getCvxCvgCvxRatio=async e=>{const t=await b.getStaticData(),a=new r(t?.convex.cvgCvxCvx1PoolContract,y.abi,await this.bcService.getStaticProvider());if(e===0n)return 0;const s=await a.get_dy(0,1,e);return d(s,18)/d(e,18)};getDy=async(e,t)=>t===0n?0n:await new r(e,y.abi,await this.bcService.getStaticProvider()).get_dy(0,1,t);async getStakingPositions(e){const t=await this.getStakingPositionId(e);return await this._getTokenData(t)}async getStakingPositionId(e){if(!e)return[];const t=await b.getStaticData();return(await new r(t.convex.cvxStakingPositionManager,C.abi,await this.bcService.getStaticProvider()).getTokenIdsAndStakingContracts(e)).map(s=>s.toObject())}async doConvert(e,t,a){const s=await b.getStaticData();return await new r(s.stakedao.cvgSDT,p.abi,a).mint(e,t)}async doStakeGauge(e,t,a,s){return await new r(t,k.abi,s).deposit(e,a,x)}async doConvertAndStake(e,t,a){const s=await b.getStaticData();return await new r(s?.stakedao.sdtUtilities,w.abi,a).convertAndStakeCvgSdt(e,0,t,t)}async doUnStake(e,t,a,s){return await new r(t,k.abi,s).withdraw(e,a)}processStakingTotals(e,t){const a={contracts:{},cvgSdt:{tvl:0},sd:{tvl:0},cvxAsset:{tvl:0},total:{tvl:0},isInit:!1};if(!e?.stakings||!t)return a;const s=t[e.cvgSdt.cvgAsset.tokenAddress];a.cvgSdt.tvl=s*d(e.cvgSdt.nextTotal,18),a.total.tvl=a.cvgSdt.tvl;const n=(f,c)=>{a.contracts[c.stakingAddress]===void 0&&(a.contracts[c.stakingAddress]={tvl:0});const o=a.contracts[c.stakingAddress],u=t[c.gaugeAsset.tokenAddress],g=d(c.nextTotal,c.gaugeAsset.decimals)*u;o.tvl=isNaN(g)?0:g,a[f].tvl+=o.tvl,a.contracts[c.stakingAddress]={tvl:o.tvl,token:c.gaugeAsset.name}};return Object.values(e?.stakings?.lps).forEach(f=>{n("cvxAsset",f)}),Object.values(e?.stakings?.sdAssets).forEach(f=>{n("sd",f)}),{...a,isInit:!0}}processUserTotals(e,t,a){const s={contracts:{},cvgSdt:{amount:0,count:0},sd:{amount:0,count:0},cvxAsset:{amount:0,count:0},total:{amount:0,count:0}};return!e?.stakings||!t||Object.entries(t).forEach(([n,f])=>{Object.values(f).forEach(c=>{const{asset:o,type:u}=this._getStakingAssetFormGlobalData(e,n);if(!o)return;const g=a&&a[o.tokenAddress]||0,v=d(c.nextToken,o.decimals)*g;s.contracts[n]===void 0&&(s.contracts[n]={amount:0,count:0}),s.contracts[n].amount+=v,s.contracts[n].count+=1,s[u].amount+=v,s[u].count+=1,s.total.amount+=v,s.total.count+=1})}),s}async getStakingPrices(e){if(!e||e.loading||e.error)return;const t=[e.cvgSdt.cvgAsset.tokenAddress];return Object.values(e.stakings.lps).forEach(a=>{t.push(a.gaugeAsset.tokenAddress)}),Object.values(e.stakings.sdAssets).forEach(a=>{t.push(a.gaugeAsset.tokenAddress)}),h.getPrices(t)}async getVeSdtInfo(){const e=await b.getStaticData(),t=new r(e?.stakedao.sdtVeBoost,A.abi,await this.bcService.getStaticProvider()),a=[t.balanceOf(e.stakedao.veSdtMultisig),t.received_balance(e.stakedao.veSdtMultisig),t.totalSupply()],s=await Promise.all(a),[n,f,c]=s.map(o=>d(o,18));return{balance:n,delegatedBalance:f,totalSupply:c}}async _getTokenData(e){const t=await b.getStaticData();return(await new r(t?.stakedao?.sdtStakingViewer,S.abi,await this.bcService.getStaticProvider()).getTokenViewSdtStaking(e)).reduce((n,f)=>(n[f.stakingContract]=n[f.stakingContract]||{},n[f.stakingContract][Number(f.tokenId)]={actualToken:f.actualToken,previousToken:f.previousToken,nextToken:f.nextToken,isCvgSdt:f.stakingContract===t?.stakedao?.cvgSdtStaking},n),{})}_getStakingAssetFormGlobalData(e,t){if(!(e===void 0||e.loading))return e.cvgSdt.cvgAssetStaking===t?{asset:e.cvgSdt.cvgAsset,type:"cvgSdt"}:e.stakings.sdAssets[t]?{asset:e.stakings.sdAssets[t].gaugeAsset,type:"sd"}:e.stakings.lps[t]?{asset:e.stakings.lps[t].gaugeAsset,type:"cvxAsset"}:{asset:void 0,type:void 0}}async getCvgSdtTotalSupply(){const e=await b.getStaticData();return await new r(e.stakedao.cvgSDT,p.abi,await this.bcService.getStaticProvider()).totalSupply()}sortList(e,t){return(a,s)=>{switch(e){case"token":return(a?.stakingName?.toUpperCase()<s?.stakingName?.toUpperCase()?1:-1)*t;case"apr":return(a?.apr?.projectedApr?.totalApr-s?.apr?.projectedApr?.totalApr)*t;case"tvl":return(a?.tvl?.tvl-s?.tvl?.tvl)*t;case"userDeposit":return((a?.userDeposit?.amount?a.userDeposit.amount:0)-(s?.userDeposit?.amount?s.userDeposit.amount:0))*t;case"boost":{const n=a?.apr?.boost?Object.values(a?.apr?.boost).reduce((c,o)=>c+(typeof o=="string"?0:o),0):0,f=s?.apr?.boost?Object.values(s?.apr?.boost).reduce((c,o)=>c+(typeof o=="string"?0:o),0):0;return(n-f)*t}case"userClaimable":return(a.userClaimable-s.userClaimable)*t;default:return 0}}}filterListByAddress(e){return t=>[t.stakingAddress?.tokenAddress,t.gaugeAsset?.tokenAddress,t.lpAsset?.tokenAddress,t.sdAsset?.tokenAddress,t.asset?.tokenAddress].includes(e)}filterListByTokenName(e){return t=>[t.stakingName?.toLowerCase(),t.gaugeAsset?.token?.toLowerCase(),t.lpAsset?.token?.toLowerCase(),t.sdAsset?.token?.toLowerCase(),t.asset?.token?.toLowerCase()].some(a=>a?.includes(e?.toLowerCase()))}async getTvlForaContract(e,t){const a=await b.getStaticData(),s=new r(a.stakedao.sdtStakingViewer,S.abi,await this.bcService.getStaticProvider());if(e==="cvgSdt")return(await s.getGlobalViewCvgSdtStaking(a.stakedao.cvgSdtStaking))?.toObject()?.nextTotal;if(e==="sd")return(await s.getGlobalViewSdAssetStaking([t]))?.toArray()?.at(0)?.nextTotal;if(e==="cvxAsset")return(await s.getGlobalViewLpAssetStaking([t]))?.toArray()?.at(0)?.nextTotal}async getStakeDaoAprs(){try{const e=await fetch("https://api.cvg.finance//stake-dao/aprs");if(e?.status===200)return await e.json()}catch(e){return console.error(e),{}}}async _getRawHarvesterInfo(){const e=(await b.getStaticData()).convex,t=[e.cvxCrvStakingPositionService,e.cvxPrismaStakingPositionService,e.cvxFxnStakingPositionService],a=await this.bcService.getStaticProvider(),s=new P(l.abi),f=await new T(l.abi,l.bytecode).getDeployTransaction(e.cvgCvxStakingPositionService,e.cvgCVX,t);return await this.bcService.excuteChainView(a,f,s)}async doProcessReward(e,t){return await new r(e,R.abi,t).processCvxRewards()}async getHarvesterInfo(){let e=await this._getRawHarvesterInfo();return e=await this._hydrateHarvestRewardList(e),e?.map(a=>({...V(a.stakingName)||{},...a}))||[]}async _hydrateHarvestRewardList(e){let t=e.filter(a=>a.tokenAmounts.some(s=>s.totalProcessable>0n)&&!a.isCvxProcessed);return await Promise.all(t.map(this._hydrateHarvestRewardInfo))}async _hydrateHarvestRewardInfo(e){e.tokenAmounts=e.tokenAmounts?.length?e.tokenAmounts.filter(t=>t.totalProcessable>0n):[];for(let t=0;t<e.tokenAmounts.length;t++){const a=await I.getErc20INfo(e.tokenAmounts[t].token);e.tokenAmounts[t]={...a,amount:e.tokenAmounts[t].totalProcessable,amountToHarvest:e.tokenAmounts[t].processorAmount}}return e}}const X=new D;export{X as s};
